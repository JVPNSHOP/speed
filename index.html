<!doctype html>
<html lang="my">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JK VIP SPEEDTEST</title>
<style>
  :root{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  body{margin:0;background:#0b1020;color:#e9ecf1}
  .wrap{max-width:980px;margin:0 auto;padding:20px}
  .card{background:#121935;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden;position:relative}
  .head{display:flex;align-items:center;gap:12px;padding:16px 18px;border-bottom:1px solid #27325c}
  .head img{width:40px;height:40px;border-radius:8px}
  .head h1{margin:0;font-size:22px;letter-spacing:.5px}
  .sub{margin:0 18px 10px;color:#9fb0d1}
  .info{display:flex;gap:14px;row-gap:6px;flex-wrap:wrap;margin:0 18px 12px}
  .chip{background:#0f1530;border:1px solid #27325c;border-radius:999px;padding:8px 12px;font-size:14px}
  .ok{color:#7cf0a6}
  .actions{display:flex;gap:10px;margin:0 18px 12px;flex-wrap:wrap}
  .btn{all:unset;background:#3b82f6;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn.alt{background:#16a34a}
  .tip{font-size:12px;color:#9fb0d1;margin:0 18px 12px}
  .frame-wrap{position:relative}
  .frame{width:100%;height:78vh;border:0;display:block;background:#0b1020}
  .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(11,16,32,.5);backdrop-filter:blur(1px);z-index:5}
  .spin{width:48px;height:48px;border-radius:50%;border:6px solid rgba(124,240,166,.25);border-top-color:#7cf0a6;animation:rot 1s linear infinite}
  @keyframes rot{to{transform:rotate(360deg)}}
  .foot{padding:12px 18px;color:#7f93c4;font-size:12px;border-top:1px solid #27325c}
  @media (max-width:600px){ .frame{height:80vh} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Speedometer_font_awesome.svg/120px-Speedometer_font_awesome.svg.png" alt="JK VIP">
        <h1>JK VIP SPEEDTEST</h1>
      </div>

      <p class="sub">Powered by M-Lab (official tester embedded)</p>

      <div class="info" id="info">
        <span class="chip">Preparing…</span>
      </div>

      <div class="actions">
        <button class="btn" id="reload">↻ Reload in page</button>
        <button class="btn alt" id="open">⤴ Open Fullscreen (recommended)</button>
      </div>

      <p class="tip">If it sticks at “Starting”, try <b>Open Fullscreen</b>, or turn off Brave Shields / ad-block / “Block third-party cookies”.</p>

      <div class="frame-wrap">
        <iframe id="mlab" class="frame"
          src="https://speed.measurementlab.net/#/?t=init"
          loading="eager"
          allow="clipboard-read; clipboard-write; fullscreen"
          referrerpolicy="no-referrer">
        </iframe>
        <div class="overlay" id="overlay"><div class="spin"></div></div>
      </div>

      <div class="foot">
        Your IP and measurement data are handled by Measurement Lab.
        <a href="https://www.measurementlab.net/privacy/" target="_blank" style="color:#9ec8ff">Privacy Policy</a>.
      </div>
    </div>
  </div>

<script>
(async function(){
  const info = document.getElementById('info');
  const overlay = document.getElementById('overlay');
  const iframe = document.getElementById('mlab');
  const reloadBtn = document.getElementById('reload');
  const openBtn = document.getElementById('open');

  const pill=(k,v,ok=false)=>{const s=document.createElement('span');s.className='chip'+(ok?' ok':'');s.textContent=`${k}: ${v}`;info.appendChild(s);};

  // client IP/location/ISP
  async function clientInfo(){
    try{
      const r=await fetch('https://ipapi.co/json/',{cache:'no-store'});
      if(r.ok){const j=await r.json();return {ip:j.ip,loc:`${j.city||'-'}, ${j.region||'-'}, ${j.country_name||'-'}`,isp:j.org||j.asn||'-'};}
    }catch{}
    try{
      const ip=await fetch('https://api64.ipify.org?format=json',{cache:'no-store'}).then(x=>x.json());
      const g =await fetch(`https://ipapi.co/${ip.ip}/json/`,{cache:'no-store'}).then(x=>x.json());
      return {ip:ip.ip,loc:`${g.city||'-'}, ${g.region||'-'}, ${g.country_name||'-'}`,isp:g.org||g.asn||'-'};
    }catch{}
    return null;
  }
  // nearest mlab server
  async function mlabInfo(){
    try{
      const r=await fetch('https://locate.measurementlab.net/v2/nearest/ndt/ndt7',{cache:'no-store'});
      const j=await r.json();const s=j.results&&j.results[0];if(!s)return null;
      let host=s.machine||''; if(!host&&s.urls&&s.urls[0]?.url){ try{host=new URL(s.urls[0].url).host;}catch{} }
      const city=s.location?.city||'-', country=s.location?.country||'-';
      return {host,where:`${city}, ${country}`};
    }catch{return null;}
  }

  // render info
  info.innerHTML='';
  const [c,m]=await Promise.all([clientInfo(),mlabInfo()]);
  if(c){ pill('Your IP',c.ip,true); pill('Location',c.loc); pill('ISP',c.isp); }
  if(m){ pill('M-Lab Server',`${m.host} (${m.where})`); }

  // hide overlay once iframe loads
  let loaded=false;
  iframe.addEventListener('load',()=>{loaded=true; setTimeout(()=>overlay.style.display='none',500);});

  // if still not loaded after 10s, suggest fullscreen
  setTimeout(()=>{ if(!loaded){ overlay.style.display='none'; document.querySelector('.tip').innerHTML='Stuck? Click <b>Open Fullscreen</b> and run the test there.'; } },10000);

  // buttons
  reloadBtn.addEventListener('click',()=>{
    overlay.style.display='flex';
    iframe.src='about:blank';
    setTimeout(()=>{ iframe.src='https://speed.measurementlab.net/#/?r='+Date.now(); },60);
  });
  openBtn.addEventListener('click',()=>{
    // open M-Lab directly (avoids iframe restrictions)
    window.location.href='https://speed.measurementlab.net/#/?from=jk-vip';
  });
})();
</script>
</body>
</html>
